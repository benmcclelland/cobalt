--JOB TABLES

CREATE TABLE COBALT_DB_DEV.JOB_DATA ( \
    ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 10 ORDER) NOT NULL PRIMARY KEY, \
    JOBID INTEGER NOT NULL, \
    UMASK INTEGER NOT NULL, \
    JOBNAME VARCHAR(256) NOT NULL, \
    JOB_TYPE VARCHAR(32) NOT NULL, \
    JOB_USER VARCHAR(16) NOT NULL, \
    WALLTIME INTEGER NOT NULL, \
    PROCS INTEGER NOT NULL, \
    NODES INTEGER NOT NULL, \
    --COMMAND VARCHAR(1024) NOT NULL, \
    --ARGS VARCHAR(1024), \
    COMMAND CLOB NOT NULL, \
    ARGS CLOB, \
    PROJECT VARCHAR(32) NOT NULL, \
    LIENID INTEGER NULL, \
    HOST VARCHAR(128), \
    PORT INTEGER, \
    --INPUTFILE VARCHAR(1024), \
    INPUTFILE CLOB, \
    KERNEL VARCHAR(128) NOT NULL, \
    KERNELOPTIONS VARCHAR(128), \
    --NOTIFY VARCHAR(1024), \
    NOTIFY CLOB, \
    ADMINEMAIL VARCHAR(80), \
    LOCATION VARCHAR(128), \
    --OUTPUTPATH VARCHAR(1024), \
    --OUTPUTDIR VARCHAR(1024), \
    --ERRORPATH VARCHAR(1024), \
    --PATH VARCHAR(1024) NOT NULL, \
    OUTPUTPATH CLOB, \
    OUTPUTDIR CLOB, \
    ERRORPATH CLOB, \
    PATH CLOB NOT NULL, \
    MODE VARCHAR(4) NOT NULL, \
    ENVS CLOB, \
    QUEUE VARCHAR(128) NOT NULL, \
    PRIORITY_CORE_HOURS INTEGER, \
    FORCE_KILL_DELAY INTEGER NOT NULL, \
    ATTRIBUTE VARCHAR(32) NOT NULL, \
    PREEMPTABLE INTEGER NOT NULL \
)


CREATE TABLE COBALT_DB_DEV.JOB_STATES ( \
    ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 10 ORDER) NOT NULL PRIMARY KEY, \
    NAME VARCHAR(32) NOT NULL \
)

CREATE TABLE COBALT_DB_DEV.JOB_PROG ( \
     ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 10 ORDER) NOT NULL PRIMARY KEY, \
     JOB_DATA_ID INTEGER NOT NULL REFERENCES COBALT_DB_DEV.JOB_DATA("ID"), \
     REASON INTEGER NOT NULL REFERENCES COBALT_DB_DEV.JOB_STATES("ID"), \
     STATE VARCHAR(32) NOT NULL, \
     EXEC_USER VARCHAR(16), \
     ENTRY_TIME TIMESTAMP NOT NULL, \
     ADMIN_HOLD INTEGER NOT NULL, \
     USER_HOLD INTEGER NOT NULL, \
     DEP_HOLD INTEGER NOT NULL, \
     MAX_RUNNING INTEGER NOT NULL, \
     DEP_FAIL INTEGER, \
     TASKID INTEGER, \
     TASK_RUNNING INTEGER, \
     SCORE DECIMAL(18,3) NOT NULL \      
)

CREATE TABLE COBALT_DB_DEV.JOB_ATTR ( \
     ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 10 ORDER) NOT NULL PRIMARY KEY, \
     JOB_DATA_ID INTEGER NOT NULL REFERENCES COBALT_DB_DEV.JOB_DATA("ID"), \
     KEY VARCHAR(128) NOT NULL, \
     VALUE VARCHAR (512) NOT NULL \
)

--CREATE TABLE COBALT_DB_DEV.JOB_NODECTS ( \
--     ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 10 ORDER) NOT NULL PRIMARY KEY, \
--     JOB_DATA_ID INTEGER NOT NULL REFERENCES COBALT_DB_DEV.JOB_DATA("ID"), \
--     VALUE VARCHAR (512) NOT NULL \
--)

--DEP_ON_ID is really a the cobalt jobid this job depends on
--SATISFIED is supposed to be a boolean value for whether the dep is satisfied.
--Not sure what will be most useful here.  It almost seems like a dep
--satisfied timestamp would be better. If null not satisfied.
--A prog entry will be created for an update to this.

CREATE TABLE COBALT_DB_DEV.JOB_DEPS( \
     ID INTEGER GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1, CACHE 10 ORDER) NOT NULL PRIMARY KEY, \
     JOB_DATA_ID INTEGER NOT NULL REFERENCES COBALT_DB_DEV.JOB_DATA("ID"), \
     DEP_ON_ID INTEGER NOT NULL, \
     SATISFIED INTEGER NOT NULL \
)